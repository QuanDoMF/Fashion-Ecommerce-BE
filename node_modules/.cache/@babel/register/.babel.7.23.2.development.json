{"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\quant\\\\Desktop\\\\ViteProject\\\\PROJECT\\\\backend\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"C:\\\\Users\\\\quant\\\\Desktop\\\\ViteProject\\\\PROJECT\\\\backend\",\"filename\":\"C:\\\\Users\\\\quant\\\\Desktop\\\\ViteProject\\\\PROJECT\\\\backend\\\\index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\quant\\\\Desktop\\\\ViteProject\\\\PROJECT\\\\backend\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.23.2:development":{"value":{"code":"// const port = 4000;\nconst express = require('express');\nconst app = express();\nconst mongoose = require(\"mongoose\");\nconst jwt = require(\"jsonwebtoken\");\nconst multer = require(\"multer\");\nconst path = require(\"path\");\nconst cors = require('cors');\nconst {\n  v4: uuid\n} = require('uuid');\napp.use(express.json());\napp.use(cors());\n\n// Database connection with MongoDB\nmongoose.connect(\"mongodb+srv://tquandoo:Quan2401@cluster0.ok2xmoe.mongodb.net/Ecommerce\");\n\n// API creation\napp.get(\"/\", (req, res) => {\n  res.send(\"Express App is Running\");\n});\nconst storage = multer.diskStorage({\n  destination: './upload/images',\n  filename: (req, file, cb) => {\n    return cb(null, `${file.fieldname}_${Date.now()}${path.extname(file.originalname)}`);\n  }\n});\nconst upload = multer({\n  storage: storage\n});\n\n//creating upload endpoint for images\n\napp.use('/images', express.static('upload/images'));\napp.post('/upload', upload.single('product'), (req, res) => {\n  res.json({\n    success: 1,\n    image_url: `https://fashion-ecommerce-be.onrender.com/images/${req.file.filename}`\n  });\n});\n\n// schema for creating product\nconst Product = mongoose.model(\"Product\", {\n  id: {\n    type: Number,\n    required: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  image: {\n    type: String,\n    required: true\n  },\n  category: {\n    type: String,\n    required: true\n  },\n  new_price: {\n    type: Number,\n    required: true\n  },\n  old_price: {\n    type: Number,\n    required: true\n  },\n  date: {\n    type: Date,\n    default: Date.now\n  },\n  avilabel: {\n    type: Boolean,\n    default: true\n  }\n});\napp.post('/addproduct', async (req, res) => {\n  let products = await Product.find({});\n  let id;\n  if (products.length > 0) {\n    let last_product_array = products.slice(-1);\n    last_product = last_product_array[0];\n    id = last_product.id + 1;\n  } else {\n    id = 1;\n  }\n  const product = new Product({\n    id: id,\n    // luôn bằng thằng cuối tăng lên 1\n    name: req.body.name,\n    image: req.body.image,\n    category: req.body.category,\n    new_price: req.body.new_price,\n    old_price: req.body.old_price\n  });\n  await product.save();\n  console.log(\"Saved\");\n  res.json({\n    success: true,\n    name: req.body.name\n  });\n});\n\n// Creating API for deleting product\n\napp.post('/removeproduct', async (req, res) => {\n  await Product.findOneAndDelete({\n    id: req.body.id\n  });\n  res.json({\n    success: true,\n    name: req.body.name\n  });\n});\n// creating API for getting all products\napp.get('/allproduct', async (req, res) => {\n  try {\n    let start = parseInt(req.query.start) || 0;\n    let limit = parseInt(req.query.limit) || 12;\n    let category = req.query.category;\n    let query = {};\n    // Nếu category được chỉ định, thêm nó vào điều kiện truy vấn\n    if (category) {\n      query.category = category;\n    }\n    let products;\n\n    // Nếu cả start, limit và category đều được chỉ định, thực hiện lấy sản phẩm theo các điều kiện này\n    if (!isNaN(start) && !isNaN(limit) && category) {\n      products = await Product.find(query).skip(start).limit(limit);\n    } else {\n      // Nếu không có cả start, limit hoặc category, hoặc thiếu bất kỳ tham số nào, lấy tất cả sản phẩm\n      products = await Product.find({});\n    }\n    res.json({\n      success: true,\n      data: products\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\"\n    });\n  }\n});\nconst Users = mongoose.model('Users', {\n  name: {\n    type: String,\n    required: true\n  },\n  email: {\n    type: String,\n    required: true\n  },\n  password: {\n    type: String,\n    required: true\n  },\n  orderList: {\n    type: Array\n  },\n  cartDetails: {\n    type: Array,\n    default: []\n  },\n  data: {\n    type: Date,\n    default: Date.now\n  }\n});\napp.post('/signup', async (req, res) => {\n  let check = await Users.findOne({\n    email: req.body.email\n  });\n  if (check) {\n    return res.status(400).json({\n      success: false,\n      errors: 'existing user found with same email'\n    });\n  }\n  let cart = {};\n  for (let i = 0; i < 300; i++) {\n    cart[i] = 0;\n  }\n  const user = new Users({\n    name: req.body.username,\n    email: req.body.email,\n    password: req.body.password,\n    orderList: [],\n    cartData: cart\n  });\n  await user.save();\n  const data = {\n    user: {\n      id: user.id,\n      username: user.name,\n      email: user.email\n    }\n  };\n  const token = jwt.sign(data, 'secret_ecom');\n  res.json({\n    success: true,\n    token,\n    username: user.name,\n    email: user.email\n  }); // Sửa ở đây\n});\n\n//creating endpoint for user login \napp.post('/login', async (req, res) => {\n  let user = await Users.findOne({\n    email: req.body.email\n  });\n  if (user) {\n    const passCompare = req.body.password === user.password;\n    if (passCompare) {\n      const data = {\n        user: {\n          id: user.id,\n          username: user.name,\n          email: user.email\n        }\n      };\n      const token = jwt.sign(data, 'secret_ecom');\n      res.json({\n        success: true,\n        token,\n        username: user.name,\n        email: user.email\n      }); // Sửa ở đây\n    } else {\n      res.json({\n        success: false,\n        errors: 'Wrong Password'\n      });\n    }\n  } else {\n    res.json({\n      success: false,\n      errors: 'Wrong Email Id'\n    });\n  }\n});\n\n// creating endpoint for newcollection data\napp.get('/popular', async (req, res) => {\n  try {\n    const limit = 4;\n    const category = 'women';\n    const popularProducts = await Product.find({\n      category\n    }).limit(limit);\n    res.json({\n      success: true,\n      data: popularProducts\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Internal server error\"\n    });\n  }\n});\n// creating endpoint for newcollection data\n// app.get('/newcollection', async (req, res) => {\n//   let products = await Product.find({})\n//   let newcollection = products.slices\n// })\n\n// creating middleware to fetch user\n\nconst fetchUser = async (req, res, next) => {\n  const token = req.header('auth-token');\n  // console.log(token)\n  if (!token) {\n    res.status(401).send({\n      errors: 'Please authenticate using valid token'\n    });\n  } else {\n    try {\n      const data = jwt.verify(token, 'secret_ecom');\n      req.user = data.user;\n      next();\n    } catch (error) {\n      res.status(401).send({\n        errors: \"Please authenticate using valid token\"\n      });\n      console.log(error);\n    }\n  }\n};\n\n// creating endpoint for adding product in cartData\n// app.post('/addtocart', fetchUser , async (req, res) => {\n//   // console.log('Added', req.body.itemId)\n//   let userData = await Users.findOne({_id: req.user.id})\n//   if(userData && userData.cartData){\n//     userData.cartData[req.body.itemId] += 1\n//     await Users.findOneAndUpdate({_id: req.user.id},{cartData: userData.cartData})\n//     res.send(\"Added\")\n//   }else{\n//     console.log('chưa có userData')\n//   }\n// })\napp.post('/addtocart', fetchUser, async (req, res) => {\n  // console.log(req.body.cartItem)\n  try {\n    const userId = req.user.id;\n    const itemId = req.body.cartItem.id; // Lấy id của sản phẩm từ request body\n    let userData = await Users.findOne({\n      _id: userId\n    });\n    // Kiểm tra xem người dùng đã có giỏ hàng hay chưa\n    if (!userData.cartDetails) {\n      userData.cartDetails = []; // Nếu chưa, khởi tạo giỏ hàng cho người dùng\n    }\n    // Tìm xem sản phẩm đã tồn tại trong giỏ hàng của người dùng chưa\n    const existingItemIndex = userData.cartDetails.findIndex(item => item.id === itemId);\n    if (existingItemIndex !== -1) {\n      // Nếu sản phẩm đã tồn tại trong giỏ hàng, tăng số lượng lên 1\n      userData.cartDetails[existingItemIndex].quantity += 1;\n    } else {\n      // Nếu sản phẩm chưa tồn tại trong giỏ hàng, thêm sản phẩm vào giỏ hàng với số lượng là 1\n      userData.cartDetails.push({\n        ...req.body.cartItem,\n        quantity: 1\n      });\n    }\n    // Lưu cập nhật giỏ hàng vào cơ sở dữ liệu\n    await userData.save();\n    res.status(200).send(\"Item added to cart successfully\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Internal server error\");\n  }\n});\n\n// app.post('/descrementfromcart', fetchUser , async (req, res) => {\n//   console.log('Removed', req.body.itemId)\n//   let userData = await Users.findOne({_id: req.user.id})\n//   if(userData.cartData[req.body.itemId] > 0) {\n//     userData.cartData[req.body.itemId] -= 1\n//     await Users.findOneAndUpdate({_id: req.user.id},{cartData: userData.cartData})\n//     res.send(\"Removed\")\n//   }\n// })\n\n// Endpoint để giảm số lượng của một sản phẩm trong giỏ hàng\napp.post('/descrementfromcart', fetchUser, async (req, res) => {\n  try {\n    const userId = req.user.id;\n    const itemId = req.body.itemId; // Lấy id của sản phẩm từ request body\n    let userData = await Users.findOne({\n      _id: userId\n    });\n    if (!userData) {\n      return res.status(404).send(\"User not found\");\n    }\n\n    // Tìm chỉ mục của sản phẩm trong giỏ hàng của người dùng\n    const itemIndex = userData.cartDetails.findIndex(item => item.id === itemId);\n    if (itemIndex !== -1 && userData.cartDetails[itemIndex] && userData.cartDetails[itemIndex].quantity > 0) {\n      console.log(\"quantity before decrement:\", userData.cartDetails[itemIndex].quantity);\n\n      // Nếu sản phẩm tồn tại trong giỏ hàng và có số lượng lớn hơn 0, giảm số lượng đi 1\n      userData.cartDetails[itemIndex].quantity -= 1;\n\n      // Lưu cập nhật giỏ hàng vào cơ sở dữ liệu\n      await userData.save();\n      console.log(\"quantity after decrement:\", userData.cartDetails[itemIndex].quantity);\n      console.log('userData', userData);\n      return res.status(200).send(\"Item quantity decremented successfully\");\n    } else {\n      return res.status(400).send(\"No items to decrement\");\n    }\n  } catch (error) {\n    console.error(error);\n    return res.status(500).send(\"Internal server error\");\n  }\n});\n\n// Endpoint để tăng số lượng của một sản phẩm trong giỏ hàng\napp.post('/incrementformcart', fetchUser, async (req, res) => {\n  try {\n    const userId = req.user.id;\n    const itemId = req.body.itemId; // Lấy id của sản phẩm từ request body\n    const userData = await Users.findOneAndUpdate({\n      _id: userId,\n      \"cartDetails.id\": itemId\n    },\n    // Tìm người dùng với ID và itemId phù hợp\n    {\n      $inc: {\n        \"cartDetails.$.quantity\": 1\n      }\n    },\n    // Tăng quantity của mục có itemId tương ứng\n    {\n      new: true\n    } // Trả về tài liệu đã cập nhật\n    );\n\n    if (userData) {\n      return res.status(200).send(\"Item quantity incremented successfully\");\n    } else {\n      return res.status(400).send(\"Item not found in cart\");\n    }\n  } catch (error) {\n    console.error(error);\n    return res.status(500).send(\"Internal server error\");\n  }\n});\n\n// Endpoint để xóa một sản phẩm khỏi giỏ hàng\napp.post('/removefromcart', fetchUser, async (req, res) => {\n  try {\n    const userId = req.user.id;\n    const itemId = req.body.itemId; // Lấy id của sản phẩm từ request body\n    let userData = await Users.findOne({\n      _id: userId\n    });\n\n    // Kiểm tra xem người dùng có giỏ hàng hay không và giỏ hàng có sản phẩm đó không\n    if (userData && userData.cartDetails) {\n      const existingItemIndex = userData.cartDetails.findIndex(item => item.id === itemId);\n      if (existingItemIndex !== -1) {\n        userData.cartDetails.splice(existingItemIndex, 1); // Xóa sản phẩm khỏi giỏ hàng\n        await userData.save();\n        return res.status(200).send(\"Item removed from cart successfully\");\n      }\n    }\n    // Nếu không tìm thấy sản phẩm, trả về thông báo lỗi\n    res.status(400).send(\"Item not found in cart\");\n  } catch (error) {\n    console.error(error);\n    res.status(500).send(\"Internal server error\");\n  }\n});\n\n// app.post('/removefromcart', fetchUser , async (req, res) => {\n//   try {\n//     const userId = req.user.id;\n//     const itemId = req.body.itemId;\n\n//     let userData = await Users.findOne({_id: userId});\n\n//     if(userData && userData.cartData && userData.cartData[itemId] > 0) {\n//       // Xóa hết số lượng sản phẩm trong giỏ hàng cho itemId\n//       userData.cartData[itemId] = 0;\n\n//       await Users.findOneAndUpdate({_id: userId}, {cartData: userData.cartData});\n//       res.status(200).send(\"All items removed\");\n//     } else {\n//       res.status(400).send(\"No items to remove\");\n//     }\n//   } catch (error) {\n//     console.error(error);\n//     res.status(500).send(\"Internal server error\");\n//   }\n// });\n\n// creating endpoint to get cartdata\n// creating endpoint to get cartdata\n\n// app.post('/getcart', fetchUser, async (req, res) => {\n//   try {\n//       // Truy xuất dữ liệu người dùng từ middleware fetchUser\n//       const userId = req.user.id;\n//       // Tìm người dùng trong cơ sở dữ liệu\n//       const userData = await Users.findOne({ _id: userId });\n\n//       console.log('userData', userData)\n//       // Kiểm tra xem dữ liệu người dùng và giỏ hàng có tồn tại không\n//       if (userData && userData.cartData) {\n//           // Nếu tồn tại, trả về dữ liệu giỏ hàng dưới dạng JSON\n//           res.json(userData.cartData);\n//       } else {\n//           // Nếu không tìm thấy dữ liệu người dùng hoặc giỏ hàng, trả về thông báo lỗi\n//           res.status(404).json({ success: false, message: 'User or cart data not found' });\n//       }\n//   } catch (error) {\n//       // Xử lý lỗi nếu có bất kỳ lỗi nào xảy ra trong quá trình xử lý yêu cầu\n//       console.error(error);\n//       res.status(500).json({ success: false, message: 'Internal server error' });\n//   }\n// });\n\n// creating endpoint for checkout cart\napp.post('/orderList', async (req, res) => {\n  try {\n    const order = req.body;\n    const user = await Users.findOne({\n      email: order.customerInfo.email\n    });\n    if (!user) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    const newOrder = {\n      orderId: order.orderId,\n      orderInfo: {\n        ...order.orderInfo,\n        orderDate: order.orderInfo.orderDate\n      },\n      orderDetails: order.orderDetails,\n      customerInfo: order.customerInfo\n    };\n    user.orderList.push(newOrder);\n    await user.save();\n    res.status(200).json({\n      success: true,\n      message: 'Order successfully processed and saved'\n    });\n  } catch (error) {\n    console.log(error);\n    res.status(500).json({\n      success: false,\n      message: 'Internal server error'\n    });\n  }\n});\n// endpoint get all orderList\n\napp.get('/orderList', async (req, res) => {\n  try {\n    const users = await Users.find({}, 'orderList');\n    const allOrderList = users.map(user => user.orderList);\n    const orderList = allOrderList.flat();\n    res.status(200).json(orderList);\n  } catch (error) {\n    console.error('Error while fetching all cartDetails:', error);\n    res.status(500).json({\n      error: 'Internal server error'\n    });\n  }\n});\nconst port = process.env.PORT || 4000; // Sử dụng cổng do Render cung cấp hoặc 4000 nếu không có cổng nào được cung cấp\n\napp.listen(port, error => {\n  if (!error) {\n    console.log(\"Server Running on port: \" + port);\n  } else {\n    console.log(\"Error:\" + error);\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImFwcCIsIm1vbmdvb3NlIiwiand0IiwibXVsdGVyIiwicGF0aCIsImNvcnMiLCJ2NCIsInV1aWQiLCJ1c2UiLCJqc29uIiwiY29ubmVjdCIsImdldCIsInJlcSIsInJlcyIsInNlbmQiLCJzdG9yYWdlIiwiZGlza1N0b3JhZ2UiLCJkZXN0aW5hdGlvbiIsImZpbGVuYW1lIiwiZmlsZSIsImNiIiwiZmllbGRuYW1lIiwiRGF0ZSIsIm5vdyIsImV4dG5hbWUiLCJvcmlnaW5hbG5hbWUiLCJ1cGxvYWQiLCJzdGF0aWMiLCJwb3N0Iiwic2luZ2xlIiwic3VjY2VzcyIsImltYWdlX3VybCIsIlByb2R1Y3QiLCJtb2RlbCIsImlkIiwidHlwZSIsIk51bWJlciIsInJlcXVpcmVkIiwibmFtZSIsIlN0cmluZyIsImltYWdlIiwiY2F0ZWdvcnkiLCJuZXdfcHJpY2UiLCJvbGRfcHJpY2UiLCJkYXRlIiwiZGVmYXVsdCIsImF2aWxhYmVsIiwiQm9vbGVhbiIsInByb2R1Y3RzIiwiZmluZCIsImxlbmd0aCIsImxhc3RfcHJvZHVjdF9hcnJheSIsInNsaWNlIiwibGFzdF9wcm9kdWN0IiwicHJvZHVjdCIsImJvZHkiLCJzYXZlIiwiY29uc29sZSIsImxvZyIsImZpbmRPbmVBbmREZWxldGUiLCJzdGFydCIsInBhcnNlSW50IiwicXVlcnkiLCJsaW1pdCIsImlzTmFOIiwic2tpcCIsImRhdGEiLCJlcnJvciIsInN0YXR1cyIsIm1lc3NhZ2UiLCJVc2VycyIsImVtYWlsIiwicGFzc3dvcmQiLCJvcmRlckxpc3QiLCJBcnJheSIsImNhcnREZXRhaWxzIiwiY2hlY2siLCJmaW5kT25lIiwiZXJyb3JzIiwiY2FydCIsImkiLCJ1c2VyIiwidXNlcm5hbWUiLCJjYXJ0RGF0YSIsInRva2VuIiwic2lnbiIsInBhc3NDb21wYXJlIiwicG9wdWxhclByb2R1Y3RzIiwiZmV0Y2hVc2VyIiwibmV4dCIsImhlYWRlciIsInZlcmlmeSIsInVzZXJJZCIsIml0ZW1JZCIsImNhcnRJdGVtIiwidXNlckRhdGEiLCJfaWQiLCJleGlzdGluZ0l0ZW1JbmRleCIsImZpbmRJbmRleCIsIml0ZW0iLCJxdWFudGl0eSIsInB1c2giLCJpdGVtSW5kZXgiLCJmaW5kT25lQW5kVXBkYXRlIiwiJGluYyIsIm5ldyIsInNwbGljZSIsIm9yZGVyIiwiY3VzdG9tZXJJbmZvIiwibmV3T3JkZXIiLCJvcmRlcklkIiwib3JkZXJJbmZvIiwib3JkZXJEYXRlIiwib3JkZXJEZXRhaWxzIiwidXNlcnMiLCJhbGxPcmRlckxpc3QiLCJtYXAiLCJmbGF0IiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwibGlzdGVuIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXHF1YW50XFxEZXNrdG9wXFxWaXRlUHJvamVjdFxcUFJPSkVDVFxcYmFja2VuZFxcIiwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLy8gY29uc3QgcG9ydCA9IDQwMDA7XHJcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJylcclxuY29uc3QgYXBwID0gZXhwcmVzcygpXHJcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZShcIm1vbmdvb3NlXCIpXHJcbmNvbnN0IGp3dCA9IHJlcXVpcmUoXCJqc29ud2VidG9rZW5cIilcclxuY29uc3QgbXVsdGVyID0gcmVxdWlyZShcIm11bHRlclwiKVxyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIilcclxuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcclxuY29uc3QgeyB2NDogdXVpZCB9ID0gcmVxdWlyZSgndXVpZCcpXHJcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpXHJcbmFwcC51c2UoY29ycygpKVxyXG5cclxuLy8gRGF0YWJhc2UgY29ubmVjdGlvbiB3aXRoIE1vbmdvREJcclxubW9uZ29vc2UuY29ubmVjdChcIm1vbmdvZGIrc3J2Oi8vdHF1YW5kb286UXVhbjI0MDFAY2x1c3RlcjAub2syeG1vZS5tb25nb2RiLm5ldC9FY29tbWVyY2VcIilcclxuXHJcbi8vIEFQSSBjcmVhdGlvblxyXG5hcHAuZ2V0KFwiL1wiLCAocmVxLCByZXMpID0+IHtcclxuICAgIHJlcy5zZW5kKFwiRXhwcmVzcyBBcHAgaXMgUnVubmluZ1wiKVxyXG59KVxyXG5cclxuY29uc3Qgc3RvcmFnZSA9IG11bHRlci5kaXNrU3RvcmFnZSh7XHJcbiAgZGVzdGluYXRpb246ICcuL3VwbG9hZC9pbWFnZXMnLFxyXG4gIGZpbGVuYW1lOiAocmVxLCBmaWxlLCBjYikgPT4ge1xyXG4gICAgICAgIHJldHVybiBjYihudWxsLCBgJHtmaWxlLmZpZWxkbmFtZX1fJHtEYXRlLm5vdygpfSR7cGF0aC5leHRuYW1lKGZpbGUub3JpZ2luYWxuYW1lKX1gKVxyXG4gIH1cclxufSlcclxuY29uc3QgdXBsb2FkID0gbXVsdGVyKHtzdG9yYWdlOiBzdG9yYWdlfSlcclxuXHJcbi8vY3JlYXRpbmcgdXBsb2FkIGVuZHBvaW50IGZvciBpbWFnZXNcclxuXHJcbmFwcC51c2UoJy9pbWFnZXMnLGV4cHJlc3Muc3RhdGljKCd1cGxvYWQvaW1hZ2VzJykpXHJcbmFwcC5wb3N0KCcvdXBsb2FkJyx1cGxvYWQuc2luZ2xlKCdwcm9kdWN0JyksKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IDEsXHJcbiAgICAgICAgICBpbWFnZV91cmw6IGBodHRwczovL2Zhc2hpb24tZWNvbW1lcmNlLWJlLm9ucmVuZGVyLmNvbS9pbWFnZXMvJHtyZXEuZmlsZS5maWxlbmFtZX1gXHJcbiAgICAgIH0pXHJcbn0pICBcclxuXHJcbi8vIHNjaGVtYSBmb3IgY3JlYXRpbmcgcHJvZHVjdFxyXG5jb25zdCBQcm9kdWN0ID0gbW9uZ29vc2UubW9kZWwoXCJQcm9kdWN0XCIsIHtcclxuICBpZDoge1xyXG4gICAgdHlwZTogTnVtYmVyLFxyXG4gICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgfSxcclxuICBuYW1lOiB7XHJcbiAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICByZXF1aXJlZDogdHJ1ZSxcclxuICB9LFxyXG4gIGltYWdlOntcclxuICAgIHR5cGU6IFN0cmluZyxcclxuICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gIH0sXHJcbiAgY2F0ZWdvcnk6IHtcclxuICAgIHR5cGU6IFN0cmluZyxcclxuICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gIH0sXHJcbiAgbmV3X3ByaWNlOiB7XHJcbiAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICByZXF1aXJlZDogdHJ1ZVxyXG4gIH0sXHJcbiAgb2xkX3ByaWNlOiB7XHJcbiAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICByZXF1aXJlZDogdHJ1ZVxyXG4gIH0sXHJcbiAgZGF0ZToge1xyXG4gICAgdHlwZTogRGF0ZSxcclxuICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgfSxcclxuICBhdmlsYWJlbDoge1xyXG4gICAgdHlwZTogQm9vbGVhbixcclxuICAgIGRlZmF1bHQ6IHRydWUsXHJcbiAgfVxyXG59KVxyXG5cclxuYXBwLnBvc3QoJy9hZGRwcm9kdWN0JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBsZXQgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoe30pXHJcbiAgICBsZXQgaWRcclxuICAgIGlmKHByb2R1Y3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBsZXQgbGFzdF9wcm9kdWN0X2FycmF5ID0gcHJvZHVjdHMuc2xpY2UoLTEpXHJcbiAgICAgICAgbGFzdF9wcm9kdWN0ID0gbGFzdF9wcm9kdWN0X2FycmF5WzBdXHJcbiAgICAgICAgaWQgPSBsYXN0X3Byb2R1Y3QuaWQgKyAxO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgIGlkID0gMVxyXG4gICAgfVxyXG4gICAgICAgIGNvbnN0IHByb2R1Y3QgPSBuZXcgUHJvZHVjdCAoe1xyXG4gICAgICAgICAgaWQ6IGlkLCAvLyBsdcO0biBi4bqxbmcgdGjhurFuZyBjdeG7kWkgdMSDbmcgbMOqbiAxXHJcbiAgICAgICAgICBuYW1lOiByZXEuYm9keS5uYW1lLFxyXG4gICAgICAgICAgaW1hZ2U6IHJlcS5ib2R5LmltYWdlLFxyXG4gICAgICAgICAgY2F0ZWdvcnk6IHJlcS5ib2R5LmNhdGVnb3J5LFxyXG4gICAgICAgICAgbmV3X3ByaWNlOiByZXEuYm9keS5uZXdfcHJpY2UsXHJcbiAgICAgICAgICBvbGRfcHJpY2U6IHJlcS5ib2R5Lm9sZF9wcmljZSxcclxuICAgICAgICB9KVxyXG4gICAgICAgIGF3YWl0IHByb2R1Y3Quc2F2ZSgpXHJcbiAgICAgICAgY29uc29sZS5sb2coXCJTYXZlZFwiKVxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICBuYW1lOiByZXEuYm9keS5uYW1lXHJcbiAgICAgICAgfSlcclxufSlcclxuXHJcbi8vIENyZWF0aW5nIEFQSSBmb3IgZGVsZXRpbmcgcHJvZHVjdFxyXG5cclxuYXBwLnBvc3QoJy9yZW1vdmVwcm9kdWN0JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgYXdhaXQgUHJvZHVjdC5maW5kT25lQW5kRGVsZXRlKHtcclxuICAgIGlkOiByZXEuYm9keS5pZFxyXG4gIH0pXHJcbiAgcmVzLmpzb24oe1xyXG4gICAgc3VjY2VzczogdHJ1ZSxcclxuICAgIG5hbWU6IHJlcS5ib2R5Lm5hbWVcclxuICB9KVxyXG59KVxyXG4vLyBjcmVhdGluZyBBUEkgZm9yIGdldHRpbmcgYWxsIHByb2R1Y3RzXHJcbmFwcC5nZXQoJy9hbGxwcm9kdWN0JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCBzdGFydCA9IHBhcnNlSW50KHJlcS5xdWVyeS5zdGFydCkgfHwgMDsgXHJcbiAgICBsZXQgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEyOyBcclxuICAgIGxldCBjYXRlZ29yeSA9IHJlcS5xdWVyeS5jYXRlZ29yeTsgXHJcbiAgICBsZXQgcXVlcnkgPSB7fTtcclxuICAgIC8vIE7hur91IGNhdGVnb3J5IMSRxrDhu6NjIGNo4buJIMSR4buLbmgsIHRow6ptIG7DsyB2w6BvIMSRaeG7gXUga2nhu4duIHRydXkgduG6pW5cclxuICAgIGlmIChjYXRlZ29yeSkge1xyXG4gICAgICBxdWVyeS5jYXRlZ29yeSA9IGNhdGVnb3J5O1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBwcm9kdWN0cztcclxuXHJcbiAgICAvLyBO4bq/dSBj4bqjIHN0YXJ0LCBsaW1pdCB2w6AgY2F0ZWdvcnkgxJHhu4F1IMSRxrDhu6NjIGNo4buJIMSR4buLbmgsIHRo4buxYyBoaeG7h24gbOG6pXkgc+G6o24gcGjhuqltIHRoZW8gY8OhYyDEkWnhu4F1IGtp4buHbiBuw6B5XHJcbiAgICBpZiAoIWlzTmFOKHN0YXJ0KSAmJiAhaXNOYU4obGltaXQpICYmIGNhdGVnb3J5KSB7XHJcbiAgICAgIHByb2R1Y3RzID0gYXdhaXQgUHJvZHVjdC5maW5kKHF1ZXJ5KS5za2lwKHN0YXJ0KS5saW1pdChsaW1pdCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBO4bq/dSBraMO0bmcgY8OzIGPhuqMgc3RhcnQsIGxpbWl0IGhv4bq3YyBjYXRlZ29yeSwgaG/hurdjIHRoaeG6v3UgYuG6pXQga+G7syB0aGFtIHPhu5EgbsOgbywgbOG6pXkgdOG6pXQgY+G6oyBz4bqjbiBwaOG6qW1cclxuICAgICAgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoe30pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgZGF0YTogcHJvZHVjdHNcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludGVybmFsIHNlcnZlciBlcnJvclwiIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5jb25zdCBVc2VycyA9IG1vbmdvb3NlLm1vZGVsKCdVc2VycycgLCB7XHJcbiAgbmFtZToge1xyXG4gICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgfSxcclxuICBlbWFpbDoge1xyXG4gICAgdHlwZTogU3RyaW5nLFxyXG4gICAgcmVxdWlyZWQ6IHRydWVcclxuICB9LFxyXG4gIHBhc3N3b3JkOiB7XHJcbiAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICByZXF1aXJlZDogdHJ1ZVxyXG4gIH0sXHJcbiAgb3JkZXJMaXN0OiB7XHJcbiAgICAgIHR5cGU6IEFycmF5LFxyXG4gIH0sXHJcbiAgY2FydERldGFpbHM6IHtcclxuICAgIHR5cGU6IEFycmF5LFxyXG4gICAgZGVmYXVsdDogW10sXHJcbiAgfSxcclxuICBkYXRhOiB7XHJcbiAgICB0eXBlOiBEYXRlLFxyXG4gICAgZGVmYXVsdDogRGF0ZS5ub3csXHJcbiAgfVxyXG59KTtcclxuYXBwLnBvc3QoJy9zaWdudXAnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGxldCBjaGVjayA9ICBhd2FpdCBVc2Vycy5maW5kT25lKHtlbWFpbDogcmVxLmJvZHkuZW1haWx9KVxyXG4gICAgaWYoY2hlY2spIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBlcnJvcnM6ICdleGlzdGluZyB1c2VyIGZvdW5kIHdpdGggc2FtZSBlbWFpbCdcclxuICAgICAgfSkgXHJcbiAgICB9XHJcbiAgICBsZXQgY2FydCA9IHt9O1xyXG4gICAgZm9yKCBsZXQgaSA9IDA7IGkgPCAzMDAgOyBpKyspe1xyXG4gICAgICBjYXJ0W2ldID0gMDtcclxuICAgIH1cclxuICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlcnMoe1xyXG4gICAgICAgIG5hbWU6IHJlcS5ib2R5LnVzZXJuYW1lLFxyXG4gICAgICAgIGVtYWlsOiByZXEuYm9keS5lbWFpbCxcclxuICAgICAgICBwYXNzd29yZDogcmVxLmJvZHkucGFzc3dvcmQsXHJcbiAgICAgICAgb3JkZXJMaXN0OiBbXSxcclxuICAgICAgICBjYXJ0RGF0YTogY2FydCxcclxuICAgIH0pXHJcbiAgICBhd2FpdCB1c2VyLnNhdmUoKVxyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgdXNlcjoge1xyXG4gICAgICAgIGlkOiB1c2VyLmlkLFxyXG4gICAgICAgIHVzZXJuYW1lOiB1c2VyLm5hbWUsXHJcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWxcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbihkYXRhLCAnc2VjcmV0X2Vjb20nKVxyXG4gICAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBcclxuICAgICAgdG9rZW4sIFxyXG4gICAgICB1c2VybmFtZTogdXNlci5uYW1lLCBcclxuICAgICAgZW1haWw6IHVzZXIuZW1haWxcclxuICAgICB9KTsgLy8gU+G7rWEg4bufIMSRw6J5XHJcbiAgfVxyXG4pXHJcblxyXG4vL2NyZWF0aW5nIGVuZHBvaW50IGZvciB1c2VyIGxvZ2luIFxyXG5hcHAucG9zdCgnL2xvZ2luJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgbGV0IHVzZXIgPSBhd2FpdCBVc2Vycy5maW5kT25lKHtcclxuICAgIGVtYWlsOiByZXEuYm9keS5lbWFpbFxyXG4gIH0pO1xyXG4gIFxyXG4gIGlmICh1c2VyKSB7XHJcbiAgICBjb25zdCBwYXNzQ29tcGFyZSA9IHJlcS5ib2R5LnBhc3N3b3JkID09PSB1c2VyLnBhc3N3b3JkO1xyXG4gICAgaWYgKHBhc3NDb21wYXJlKSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgaWQ6IHVzZXIuaWQsXHJcbiAgICAgICAgICB1c2VybmFtZTogdXNlci5uYW1lLFxyXG4gICAgICAgICAgZW1haWw6IHVzZXIuZW1haWxcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oZGF0YSwgJ3NlY3JldF9lY29tJyk7XHJcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgXHJcbiAgICAgICAgICAgICAgICAgICAgdG9rZW4sIFxyXG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyLm5hbWUsIFxyXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsIH0pOyAvLyBT4butYSDhu58gxJHDonlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlcy5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yczogJ1dyb25nIFBhc3N3b3JkJyB9KTtcclxuICAgIH1cclxuICB9IGVsc2Uge1xyXG4gICAgcmVzLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3JzOiAnV3JvbmcgRW1haWwgSWQnIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBjcmVhdGluZyBlbmRwb2ludCBmb3IgbmV3Y29sbGVjdGlvbiBkYXRhXHJcbmFwcC5nZXQoJy9wb3B1bGFyJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5e1xyXG4gICAgY29uc3QgbGltaXQgPSA0XHJcbiAgICBjb25zdCBjYXRlZ29yeSA9ICd3b21lbidcclxuXHJcbiAgICBjb25zdCBwb3B1bGFyUHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoe2NhdGVnb3J5fSkubGltaXQobGltaXQpXHJcblxyXG4gICAgcmVzLmpzb24oe1xyXG4gICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICBkYXRhOiBwb3B1bGFyUHJvZHVjdHNcclxuICAgIH0pXHJcbiAgfWNhdGNoIChlcnJvcikge1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIiB9KTtcclxuICB9XHJcbn0pXHJcbi8vIGNyZWF0aW5nIGVuZHBvaW50IGZvciBuZXdjb2xsZWN0aW9uIGRhdGFcclxuLy8gYXBwLmdldCgnL25ld2NvbGxlY3Rpb24nLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuLy8gICBsZXQgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoe30pXHJcbi8vICAgbGV0IG5ld2NvbGxlY3Rpb24gPSBwcm9kdWN0cy5zbGljZXNcclxuLy8gfSlcclxuXHJcbi8vIGNyZWF0aW5nIG1pZGRsZXdhcmUgdG8gZmV0Y2ggdXNlclxyXG5cclxuY29uc3QgZmV0Y2hVc2VyID0gYXN5bmMgKHJlcSxyZXMsIG5leHQpID0+IHtcclxuICAgIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcignYXV0aC10b2tlbicpXHJcbiAgICAvLyBjb25zb2xlLmxvZyh0b2tlbilcclxuICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICByZXMuc3RhdHVzKDQwMSkuc2VuZCh7XHJcbiAgICAgICAgICBlcnJvcnM6ICdQbGVhc2UgYXV0aGVudGljYXRlIHVzaW5nIHZhbGlkIHRva2VuJ1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICAgIGVsc2VcclxuICAgICAge1xyXG4gICAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gand0LnZlcmlmeSh0b2tlbiwgJ3NlY3JldF9lY29tJylcclxuICAgICAgICAgICAgcmVxLnVzZXIgPSBkYXRhLnVzZXJcclxuICAgICAgICAgICAgbmV4dCgpXHJcbiAgICAgICAgICB9Y2F0Y2goZXJyb3Ipe1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwMSkuc2VuZCh7ZXJyb3JzOiBcIlBsZWFzZSBhdXRoZW50aWNhdGUgdXNpbmcgdmFsaWQgdG9rZW5cIn0pXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxufVxyXG5cclxuLy8gY3JlYXRpbmcgZW5kcG9pbnQgZm9yIGFkZGluZyBwcm9kdWN0IGluIGNhcnREYXRhXHJcbi8vIGFwcC5wb3N0KCcvYWRkdG9jYXJ0JywgZmV0Y2hVc2VyICwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbi8vICAgLy8gY29uc29sZS5sb2coJ0FkZGVkJywgcmVxLmJvZHkuaXRlbUlkKVxyXG4vLyAgIGxldCB1c2VyRGF0YSA9IGF3YWl0IFVzZXJzLmZpbmRPbmUoe19pZDogcmVxLnVzZXIuaWR9KVxyXG4vLyAgIGlmKHVzZXJEYXRhICYmIHVzZXJEYXRhLmNhcnREYXRhKXtcclxuLy8gICAgIHVzZXJEYXRhLmNhcnREYXRhW3JlcS5ib2R5Lml0ZW1JZF0gKz0gMVxyXG4vLyAgICAgYXdhaXQgVXNlcnMuZmluZE9uZUFuZFVwZGF0ZSh7X2lkOiByZXEudXNlci5pZH0se2NhcnREYXRhOiB1c2VyRGF0YS5jYXJ0RGF0YX0pXHJcbi8vICAgICByZXMuc2VuZChcIkFkZGVkXCIpXHJcbi8vICAgfWVsc2V7XHJcbi8vICAgICBjb25zb2xlLmxvZygnY2jGsGEgY8OzIHVzZXJEYXRhJylcclxuLy8gICB9XHJcbi8vIH0pXHJcbmFwcC5wb3N0KCcvYWRkdG9jYXJ0JywgZmV0Y2hVc2VyICwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgLy8gY29uc29sZS5sb2cocmVxLmJvZHkuY2FydEl0ZW0pXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xyXG4gICAgY29uc3QgaXRlbUlkID0gcmVxLmJvZHkuY2FydEl0ZW0uaWQ7IC8vIEzhuqV5IGlkIGPhu6dhIHPhuqNuIHBo4bqpbSB04burIHJlcXVlc3QgYm9keVxyXG4gICAgbGV0IHVzZXJEYXRhID0gYXdhaXQgVXNlcnMuZmluZE9uZSh7X2lkOiB1c2VySWR9KTtcclxuICAgIC8vIEtp4buDbSB0cmEgeGVtIG5nxrDhu51pIGTDuW5nIMSRw6MgY8OzIGdp4buPIGjDoG5nIGhheSBjaMawYVxyXG4gICAgaWYgKCF1c2VyRGF0YS5jYXJ0RGV0YWlscykge1xyXG4gICAgICB1c2VyRGF0YS5jYXJ0RGV0YWlscyA9IFtdOyAvLyBO4bq/dSBjaMawYSwga2jhu59pIHThuqFvIGdp4buPIGjDoG5nIGNobyBuZ8aw4budaSBkw7luZ1xyXG4gICAgfVxyXG4gICAgLy8gVMOsbSB4ZW0gc+G6o24gcGjhuqltIMSRw6MgdOG7k24gdOG6oWkgdHJvbmcgZ2nhu48gaMOgbmcgY+G7p2EgbmfGsOG7nWkgZMO5bmcgY2jGsGFcclxuICAgIGNvbnN0IGV4aXN0aW5nSXRlbUluZGV4ID0gdXNlckRhdGEuY2FydERldGFpbHMuZmluZEluZGV4KGl0ZW0gPT4gaXRlbS5pZCA9PT0gaXRlbUlkKTtcclxuICAgIGlmIChleGlzdGluZ0l0ZW1JbmRleCAhPT0gLTEpIHtcclxuICAgICAgLy8gTuG6v3Ugc+G6o24gcGjhuqltIMSRw6MgdOG7k24gdOG6oWkgdHJvbmcgZ2nhu48gaMOgbmcsIHTEg25nIHPhu5EgbMaw4bujbmcgbMOqbiAxXHJcbiAgICAgIHVzZXJEYXRhLmNhcnREZXRhaWxzW2V4aXN0aW5nSXRlbUluZGV4XS5xdWFudGl0eSArPSAxO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gTuG6v3Ugc+G6o24gcGjhuqltIGNoxrBhIHThu5NuIHThuqFpIHRyb25nIGdp4buPIGjDoG5nLCB0aMOqbSBz4bqjbiBwaOG6qW0gdsOgbyBnaeG7jyBow6BuZyB24bubaSBz4buRIGzGsOG7o25nIGzDoCAxXHJcbiAgICAgIHVzZXJEYXRhLmNhcnREZXRhaWxzLnB1c2goe1xyXG4gICAgICAgIC4uLnJlcS5ib2R5LmNhcnRJdGVtLFxyXG4gICAgICAgIHF1YW50aXR5OiAxXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgLy8gTMawdSBj4bqtcCBuaOG6rXQgZ2nhu48gaMOgbmcgdsOgbyBjxqEgc+G7nyBk4buvIGxp4buHdVxyXG4gICAgYXdhaXQgdXNlckRhdGEuc2F2ZSgpO1xyXG5cclxuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKFwiSXRlbSBhZGRlZCB0byBjYXJ0IHN1Y2Nlc3NmdWxseVwiKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChcIkludGVybmFsIHNlcnZlciBlcnJvclwiKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gYXBwLnBvc3QoJy9kZXNjcmVtZW50ZnJvbWNhcnQnLCBmZXRjaFVzZXIgLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuLy8gICBjb25zb2xlLmxvZygnUmVtb3ZlZCcsIHJlcS5ib2R5Lml0ZW1JZClcclxuLy8gICBsZXQgdXNlckRhdGEgPSBhd2FpdCBVc2Vycy5maW5kT25lKHtfaWQ6IHJlcS51c2VyLmlkfSlcclxuLy8gICBpZih1c2VyRGF0YS5jYXJ0RGF0YVtyZXEuYm9keS5pdGVtSWRdID4gMCkge1xyXG4vLyAgICAgdXNlckRhdGEuY2FydERhdGFbcmVxLmJvZHkuaXRlbUlkXSAtPSAxXHJcbi8vICAgICBhd2FpdCBVc2Vycy5maW5kT25lQW5kVXBkYXRlKHtfaWQ6IHJlcS51c2VyLmlkfSx7Y2FydERhdGE6IHVzZXJEYXRhLmNhcnREYXRhfSlcclxuLy8gICAgIHJlcy5zZW5kKFwiUmVtb3ZlZFwiKVxyXG4vLyAgIH1cclxuLy8gfSlcclxuXHJcbi8vIEVuZHBvaW50IMSR4buDIGdp4bqjbSBz4buRIGzGsOG7o25nIGPhu6dhIG3hu5l0IHPhuqNuIHBo4bqpbSB0cm9uZyBnaeG7jyBow6BuZ1xyXG5hcHAucG9zdCgnL2Rlc2NyZW1lbnRmcm9tY2FydCcsIGZldGNoVXNlciwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xyXG4gICAgY29uc3QgaXRlbUlkID0gcmVxLmJvZHkuaXRlbUlkOyAvLyBM4bqleSBpZCBj4bunYSBz4bqjbiBwaOG6qW0gdOG7qyByZXF1ZXN0IGJvZHlcclxuICAgIGxldCB1c2VyRGF0YSA9IGF3YWl0IFVzZXJzLmZpbmRPbmUoeyBfaWQ6IHVzZXJJZCB9KTtcclxuXHJcbiAgICBpZiAoIXVzZXJEYXRhKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuc2VuZChcIlVzZXIgbm90IGZvdW5kXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFTDrG0gY2jhu4kgbeG7pWMgY+G7p2Egc+G6o24gcGjhuqltIHRyb25nIGdp4buPIGjDoG5nIGPhu6dhIG5nxrDhu51pIGTDuW5nXHJcbiAgICBjb25zdCBpdGVtSW5kZXggPSB1c2VyRGF0YS5jYXJ0RGV0YWlscy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSBpdGVtSWQpO1xyXG4gICAgaWYgKGl0ZW1JbmRleCAhPT0gLTEgJiYgdXNlckRhdGEuY2FydERldGFpbHNbaXRlbUluZGV4XSAmJiB1c2VyRGF0YS5jYXJ0RGV0YWlsc1tpdGVtSW5kZXhdLnF1YW50aXR5ID4gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhcInF1YW50aXR5IGJlZm9yZSBkZWNyZW1lbnQ6XCIsIHVzZXJEYXRhLmNhcnREZXRhaWxzW2l0ZW1JbmRleF0ucXVhbnRpdHkpO1xyXG4gICAgICBcclxuICAgICAgLy8gTuG6v3Ugc+G6o24gcGjhuqltIHThu5NuIHThuqFpIHRyb25nIGdp4buPIGjDoG5nIHbDoCBjw7Mgc+G7kSBsxrDhu6NuZyBs4bubbiBoxqFuIDAsIGdp4bqjbSBz4buRIGzGsOG7o25nIMSRaSAxXHJcbiAgICAgIHVzZXJEYXRhLmNhcnREZXRhaWxzW2l0ZW1JbmRleF0ucXVhbnRpdHkgLT0gMTtcclxuICAgICAgXHJcbiAgICAgIC8vIEzGsHUgY+G6rXAgbmjhuq10IGdp4buPIGjDoG5nIHbDoG8gY8ahIHPhu58gZOG7ryBsaeG7h3VcclxuICAgICAgYXdhaXQgdXNlckRhdGEuc2F2ZSgpO1xyXG4gICAgICBjb25zb2xlLmxvZyhcInF1YW50aXR5IGFmdGVyIGRlY3JlbWVudDpcIiwgdXNlckRhdGEuY2FydERldGFpbHNbaXRlbUluZGV4XS5xdWFudGl0eSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCd1c2VyRGF0YScsIHVzZXJEYXRhKVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5zZW5kKFwiSXRlbSBxdWFudGl0eSBkZWNyZW1lbnRlZCBzdWNjZXNzZnVsbHlcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoXCJObyBpdGVtcyB0byBkZWNyZW1lbnRcIik7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIpO1xyXG4gIH1cclxufSk7XHJcblxyXG5cclxuXHJcblxyXG4vLyBFbmRwb2ludCDEkeG7gyB0xINuZyBz4buRIGzGsOG7o25nIGPhu6dhIG3hu5l0IHPhuqNuIHBo4bqpbSB0cm9uZyBnaeG7jyBow6BuZ1xyXG5hcHAucG9zdCgnL2luY3JlbWVudGZvcm1jYXJ0JywgZmV0Y2hVc2VyLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIuaWQ7XHJcbiAgICBjb25zdCBpdGVtSWQgPSByZXEuYm9keS5pdGVtSWQ7IC8vIEzhuqV5IGlkIGPhu6dhIHPhuqNuIHBo4bqpbSB04burIHJlcXVlc3QgYm9keVxyXG4gICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCBVc2Vycy5maW5kT25lQW5kVXBkYXRlKFxyXG4gICAgICB7IF9pZDogdXNlcklkLCBcImNhcnREZXRhaWxzLmlkXCI6IGl0ZW1JZCB9LCAvLyBUw6xtIG5nxrDhu51pIGTDuW5nIHbhu5tpIElEIHbDoCBpdGVtSWQgcGjDuSBo4bujcFxyXG4gICAgICB7ICRpbmM6IHsgXCJjYXJ0RGV0YWlscy4kLnF1YW50aXR5XCI6IDEgfSB9LCAvLyBUxINuZyBxdWFudGl0eSBj4bunYSBt4bulYyBjw7MgaXRlbUlkIHTGsMahbmcg4bupbmdcclxuICAgICAgeyBuZXc6IHRydWUgfSAvLyBUcuG6oyB24buBIHTDoGkgbGnhu4d1IMSRw6MgY+G6rXAgbmjhuq10XHJcbiAgICApO1xyXG5cclxuICAgIGlmICh1c2VyRGF0YSkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoXCJJdGVtIHF1YW50aXR5IGluY3JlbWVudGVkIHN1Y2Nlc3NmdWxseVwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZChcIkl0ZW0gbm90IGZvdW5kIGluIGNhcnRcIik7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiSW50ZXJuYWwgc2VydmVyIGVycm9yXCIpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBFbmRwb2ludCDEkeG7gyB4w7NhIG3hu5l0IHPhuqNuIHBo4bqpbSBraOG7j2kgZ2nhu48gaMOgbmdcclxuYXBwLnBvc3QoJy9yZW1vdmVmcm9tY2FydCcsIGZldGNoVXNlciAsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlci5pZDtcclxuICAgIGNvbnN0IGl0ZW1JZCA9IHJlcS5ib2R5Lml0ZW1JZDsgLy8gTOG6pXkgaWQgY+G7p2Egc+G6o24gcGjhuqltIHThu6sgcmVxdWVzdCBib2R5XHJcbiAgICBsZXQgdXNlckRhdGEgPSBhd2FpdCBVc2Vycy5maW5kT25lKHtfaWQ6IHVzZXJJZH0pO1xyXG5cclxuICAgIC8vIEtp4buDbSB0cmEgeGVtIG5nxrDhu51pIGTDuW5nIGPDsyBnaeG7jyBow6BuZyBoYXkga2jDtG5nIHbDoCBnaeG7jyBow6BuZyBjw7Mgc+G6o24gcGjhuqltIMSRw7Mga2jDtG5nXHJcbiAgICBpZiAodXNlckRhdGEgJiYgdXNlckRhdGEuY2FydERldGFpbHMpIHtcclxuICAgICAgY29uc3QgZXhpc3RpbmdJdGVtSW5kZXggPSB1c2VyRGF0YS5jYXJ0RGV0YWlscy5maW5kSW5kZXgoaXRlbSA9PiBpdGVtLmlkID09PSBpdGVtSWQpO1xyXG4gICAgICBpZiAoZXhpc3RpbmdJdGVtSW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgdXNlckRhdGEuY2FydERldGFpbHMuc3BsaWNlKGV4aXN0aW5nSXRlbUluZGV4LCAxKTsgLy8gWMOzYSBz4bqjbiBwaOG6qW0ga2jhu49pIGdp4buPIGjDoG5nXHJcbiAgICAgICAgYXdhaXQgdXNlckRhdGEuc2F2ZSgpO1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZChcIkl0ZW0gcmVtb3ZlZCBmcm9tIGNhcnQgc3VjY2Vzc2Z1bGx5XCIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBO4bq/dSBraMO0bmcgdMOsbSB0aOG6pXkgc+G6o24gcGjhuqltLCB0cuG6oyB24buBIHRow7RuZyBiw6FvIGzhu5dpXHJcbiAgICByZXMuc3RhdHVzKDQwMCkuc2VuZChcIkl0ZW0gbm90IGZvdW5kIGluIGNhcnRcIik7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgcmVzLnN0YXR1cyg1MDApLnNlbmQoXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIik7XHJcbiAgfVxyXG59KTtcclxuXHJcblxyXG4vLyBhcHAucG9zdCgnL3JlbW92ZWZyb21jYXJ0JywgZmV0Y2hVc2VyICwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbi8vICAgdHJ5IHtcclxuLy8gICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xyXG4vLyAgICAgY29uc3QgaXRlbUlkID0gcmVxLmJvZHkuaXRlbUlkO1xyXG5cclxuLy8gICAgIGxldCB1c2VyRGF0YSA9IGF3YWl0IFVzZXJzLmZpbmRPbmUoe19pZDogdXNlcklkfSk7XHJcblxyXG4vLyAgICAgaWYodXNlckRhdGEgJiYgdXNlckRhdGEuY2FydERhdGEgJiYgdXNlckRhdGEuY2FydERhdGFbaXRlbUlkXSA+IDApIHtcclxuLy8gICAgICAgLy8gWMOzYSBo4bq/dCBz4buRIGzGsOG7o25nIHPhuqNuIHBo4bqpbSB0cm9uZyBnaeG7jyBow6BuZyBjaG8gaXRlbUlkXHJcbi8vICAgICAgIHVzZXJEYXRhLmNhcnREYXRhW2l0ZW1JZF0gPSAwO1xyXG5cclxuLy8gICAgICAgYXdhaXQgVXNlcnMuZmluZE9uZUFuZFVwZGF0ZSh7X2lkOiB1c2VySWR9LCB7Y2FydERhdGE6IHVzZXJEYXRhLmNhcnREYXRhfSk7XHJcbi8vICAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKFwiQWxsIGl0ZW1zIHJlbW92ZWRcIik7XHJcbi8vICAgICB9IGVsc2Uge1xyXG4vLyAgICAgICByZXMuc3RhdHVzKDQwMCkuc2VuZChcIk5vIGl0ZW1zIHRvIHJlbW92ZVwiKTtcclxuLy8gICAgIH1cclxuLy8gICB9IGNhdGNoIChlcnJvcikge1xyXG4vLyAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbi8vICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZChcIkludGVybmFsIHNlcnZlciBlcnJvclwiKTtcclxuLy8gICB9XHJcbi8vIH0pO1xyXG5cclxuLy8gY3JlYXRpbmcgZW5kcG9pbnQgdG8gZ2V0IGNhcnRkYXRhXHJcbi8vIGNyZWF0aW5nIGVuZHBvaW50IHRvIGdldCBjYXJ0ZGF0YVxyXG5cclxuLy8gYXBwLnBvc3QoJy9nZXRjYXJ0JywgZmV0Y2hVc2VyLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuLy8gICB0cnkge1xyXG4vLyAgICAgICAvLyBUcnV5IHh14bqldCBk4buvIGxp4buHdSBuZ8aw4budaSBkw7luZyB04burIG1pZGRsZXdhcmUgZmV0Y2hVc2VyXHJcbi8vICAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xyXG4vLyAgICAgICAvLyBUw6xtIG5nxrDhu51pIGTDuW5nIHRyb25nIGPGoSBz4bufIGThu68gbGnhu4d1XHJcbi8vICAgICAgIGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgVXNlcnMuZmluZE9uZSh7IF9pZDogdXNlcklkIH0pO1xyXG5cclxuLy8gICAgICAgY29uc29sZS5sb2coJ3VzZXJEYXRhJywgdXNlckRhdGEpXHJcbi8vICAgICAgIC8vIEtp4buDbSB0cmEgeGVtIGThu68gbGnhu4d1IG5nxrDhu51pIGTDuW5nIHbDoCBnaeG7jyBow6BuZyBjw7MgdOG7k24gdOG6oWkga2jDtG5nXHJcbi8vICAgICAgIGlmICh1c2VyRGF0YSAmJiB1c2VyRGF0YS5jYXJ0RGF0YSkge1xyXG4vLyAgICAgICAgICAgLy8gTuG6v3UgdOG7k24gdOG6oWksIHRy4bqjIHbhu4EgZOG7ryBsaeG7h3UgZ2nhu48gaMOgbmcgZMaw4bubaSBk4bqhbmcgSlNPTlxyXG4vLyAgICAgICAgICAgcmVzLmpzb24odXNlckRhdGEuY2FydERhdGEpO1xyXG4vLyAgICAgICB9IGVsc2Uge1xyXG4vLyAgICAgICAgICAgLy8gTuG6v3Uga2jDtG5nIHTDrG0gdGjhuqV5IGThu68gbGnhu4d1IG5nxrDhu51pIGTDuW5nIGhv4bq3YyBnaeG7jyBow6BuZywgdHLhuqMgduG7gSB0aMO0bmcgYsOhbyBs4buXaVxyXG4vLyAgICAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1VzZXIgb3IgY2FydCBkYXRhIG5vdCBmb3VuZCcgfSk7XHJcbi8vICAgICAgIH1cclxuLy8gICB9IGNhdGNoIChlcnJvcikge1xyXG4vLyAgICAgICAvLyBY4butIGzDvSBs4buXaSBu4bq/dSBjw7MgYuG6pXQga+G7syBs4buXaSBuw6BvIHjhuqN5IHJhIHRyb25nIHF1w6EgdHLDrG5oIHjhu60gbMO9IHnDqnUgY+G6p3VcclxuLy8gICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbi8vICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xyXG4vLyAgIH1cclxuLy8gfSk7XHJcblxyXG5cclxuLy8gY3JlYXRpbmcgZW5kcG9pbnQgZm9yIGNoZWNrb3V0IGNhcnRcclxuYXBwLnBvc3QoJy9vcmRlckxpc3QnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICB0cnl7XHJcbiAgICBjb25zdCBvcmRlciA9IHJlcS5ib2R5XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlcnMuZmluZE9uZSh7XHJcbiAgICAgICAgZW1haWw6ICBvcmRlci5jdXN0b21lckluZm8uZW1haWxcclxuICAgIH0pXHJcbiAgICBpZighdXNlcil7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJ1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgY29uc3QgbmV3T3JkZXIgPSB7IFxyXG4gICAgICBvcmRlcklkIDogb3JkZXIub3JkZXJJZCxcclxuICAgICAgb3JkZXJJbmZvIDoge1xyXG4gICAgICAgIC4uLm9yZGVyLm9yZGVySW5mbyxcclxuICAgICAgICBvcmRlckRhdGU6IG9yZGVyLm9yZGVySW5mby5vcmRlckRhdGVcclxuICAgICAgfSxcclxuICAgICAgb3JkZXJEZXRhaWxzOiBvcmRlci5vcmRlckRldGFpbHMsXHJcbiAgICAgIGN1c3RvbWVySW5mbyA6IG9yZGVyLmN1c3RvbWVySW5mb1xyXG4gICAgfVxyXG5cclxuICAgIHVzZXIub3JkZXJMaXN0LnB1c2gobmV3T3JkZXIpXHJcblxyXG4gICAgYXdhaXQgdXNlci5zYXZlKClcclxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogJ09yZGVyIHN1Y2Nlc3NmdWxseSBwcm9jZXNzZWQgYW5kIHNhdmVkJ1xyXG4gICAgfSlcclxuICB9Y2F0Y2goZXJyb3Ipe1xyXG4gICAgY29uc29sZS5sb2coZXJyb3IpXHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSlcclxuICB9XHJcbn0pXHJcbi8vIGVuZHBvaW50IGdldCBhbGwgb3JkZXJMaXN0XHJcblxyXG5hcHAuZ2V0KCcvb3JkZXJMaXN0JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgXHJcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IFVzZXJzLmZpbmQoe30sICdvcmRlckxpc3QnKTtcclxuICAgIGNvbnN0IGFsbE9yZGVyTGlzdCA9IHVzZXJzLm1hcCh1c2VyID0+IHVzZXIub3JkZXJMaXN0KTtcclxuXHJcbiAgICBjb25zdCBvcmRlckxpc3QgPSBhbGxPcmRlckxpc3QuZmxhdCgpXHJcblxyXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24ob3JkZXJMaXN0KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igd2hpbGUgZmV0Y2hpbmcgYWxsIGNhcnREZXRhaWxzOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5jb25zdCBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCA0MDAwOyAvLyBT4butIGThu6VuZyBj4buVbmcgZG8gUmVuZGVyIGN1bmcgY+G6pXAgaG/hurdjIDQwMDAgbuG6v3Uga2jDtG5nIGPDsyBj4buVbmcgbsOgbyDEkcaw4bujYyBjdW5nIGPhuqVwXHJcblxyXG5hcHAubGlzdGVuKHBvcnQsIChlcnJvcikgPT4ge1xyXG4gIGlmICghZXJyb3IpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiU2VydmVyIFJ1bm5pbmcgb24gcG9ydDogXCIgKyBwb3J0KTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc29sZS5sb2coXCJFcnJvcjpcIiArIGVycm9yKTtcclxuICB9XHJcbn0pOyJdLCJtYXBwaW5ncyI6IkFBQ0E7QUFDQSxNQUFNQSxPQUFP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","map":{"version":3,"names":["express","require","app","mongoose","jwt","multer","path","cors","v4","uuid","use","json","connect","get","req","res","send","storage","diskStorage","destination","filename","file","cb","fieldname","Date","now","extname","originalname","upload","static","post","single","success","image_url","Product","model","id","type","Number","required","name","String","image","category","new_price","old_price","date","default","avilabel","Boolean","products","find","length","last_product_array","slice","last_product","product","body","save","console","log","findOneAndDelete","start","parseInt","query","limit","isNaN","skip","data","error","status","message","Users","email","password","orderList","Array","cartDetails","check","findOne","errors","cart","i","user","username","cartData","token","sign","passCompare","popularProducts","fetchUser","next","header","verify","userId","itemId","cartItem","userData","_id","existingItemIndex","findIndex","item","quantity","push","itemIndex","findOneAndUpdate","$inc","new","splice","order","customerInfo","newOrder","orderId","orderInfo","orderDate","orderDetails","users","allOrderList","map","flat","port","process","env","PORT","listen"],"sourceRoot":"C:\\Users\\quant\\Desktop\\ViteProject\\PROJECT\\backend\\","sources":["index.js"],"sourcesContent":["\r\n// const port = 4000;\r\nconst express = require('express')\r\nconst app = express()\r\nconst mongoose = require(\"mongoose\")\r\nconst jwt = require(\"jsonwebtoken\")\r\nconst multer = require(\"multer\")\r\nconst path = require(\"path\")\r\nconst cors = require('cors');\r\nconst { v4: uuid } = require('uuid')\r\napp.use(express.json())\r\napp.use(cors())\r\n\r\n// Database connection with MongoDB\r\nmongoose.connect(\"mongodb+srv://tquandoo:Quan2401@cluster0.ok2xmoe.mongodb.net/Ecommerce\")\r\n\r\n// API creation\r\napp.get(\"/\", (req, res) => {\r\n    res.send(\"Express App is Running\")\r\n})\r\n\r\nconst storage = multer.diskStorage({\r\n  destination: './upload/images',\r\n  filename: (req, file, cb) => {\r\n        return cb(null, `${file.fieldname}_${Date.now()}${path.extname(file.originalname)}`)\r\n  }\r\n})\r\nconst upload = multer({storage: storage})\r\n\r\n//creating upload endpoint for images\r\n\r\napp.use('/images',express.static('upload/images'))\r\napp.post('/upload',upload.single('product'),(req, res) => {\r\n      res.json({\r\n          success: 1,\r\n          image_url: `https://fashion-ecommerce-be.onrender.com/images/${req.file.filename}`\r\n      })\r\n})  \r\n\r\n// schema for creating product\r\nconst Product = mongoose.model(\"Product\", {\r\n  id: {\r\n    type: Number,\r\n    required: true,\r\n  },\r\n  name: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  image:{\r\n    type: String,\r\n    required: true,\r\n  },\r\n  category: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  new_price: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  old_price: {\r\n    type: Number,\r\n    required: true\r\n  },\r\n  date: {\r\n    type: Date,\r\n    default: Date.now\r\n  },\r\n  avilabel: {\r\n    type: Boolean,\r\n    default: true,\r\n  }\r\n})\r\n\r\napp.post('/addproduct', async (req, res) => {\r\n    let products = await Product.find({})\r\n    let id\r\n    if(products.length > 0) {\r\n        let last_product_array = products.slice(-1)\r\n        last_product = last_product_array[0]\r\n        id = last_product.id + 1;\r\n    }else{\r\n      id = 1\r\n    }\r\n        const product = new Product ({\r\n          id: id, // luôn bằng thằng cuối tăng lên 1\r\n          name: req.body.name,\r\n          image: req.body.image,\r\n          category: req.body.category,\r\n          new_price: req.body.new_price,\r\n          old_price: req.body.old_price,\r\n        })\r\n        await product.save()\r\n        console.log(\"Saved\")\r\n        res.json({\r\n          success: true,\r\n          name: req.body.name\r\n        })\r\n})\r\n\r\n// Creating API for deleting product\r\n\r\napp.post('/removeproduct', async (req, res) => {\r\n  await Product.findOneAndDelete({\r\n    id: req.body.id\r\n  })\r\n  res.json({\r\n    success: true,\r\n    name: req.body.name\r\n  })\r\n})\r\n// creating API for getting all products\r\napp.get('/allproduct', async (req, res) => {\r\n  try {\r\n    let start = parseInt(req.query.start) || 0; \r\n    let limit = parseInt(req.query.limit) || 12; \r\n    let category = req.query.category; \r\n    let query = {};\r\n    // Nếu category được chỉ định, thêm nó vào điều kiện truy vấn\r\n    if (category) {\r\n      query.category = category;\r\n    }\r\n\r\n    let products;\r\n\r\n    // Nếu cả start, limit và category đều được chỉ định, thực hiện lấy sản phẩm theo các điều kiện này\r\n    if (!isNaN(start) && !isNaN(limit) && category) {\r\n      products = await Product.find(query).skip(start).limit(limit);\r\n    } else {\r\n      // Nếu không có cả start, limit hoặc category, hoặc thiếu bất kỳ tham số nào, lấy tất cả sản phẩm\r\n      products = await Product.find({});\r\n    }\r\n\r\n    res.json({\r\n      success: true,\r\n      data: products\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({ success: false, message: \"Internal server error\" });\r\n  }\r\n});\r\n\r\nconst Users = mongoose.model('Users' , {\r\n  name: {\r\n      type: String,\r\n      required: true\r\n  },\r\n  email: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  password: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  orderList: {\r\n      type: Array,\r\n  },\r\n  cartDetails: {\r\n    type: Array,\r\n    default: [],\r\n  },\r\n  data: {\r\n    type: Date,\r\n    default: Date.now,\r\n  }\r\n});\r\napp.post('/signup', async (req, res) => {\r\n    let check =  await Users.findOne({email: req.body.email})\r\n    if(check) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        errors: 'existing user found with same email'\r\n      }) \r\n    }\r\n    let cart = {};\r\n    for( let i = 0; i < 300 ; i++){\r\n      cart[i] = 0;\r\n    }\r\n    const user = new Users({\r\n        name: req.body.username,\r\n        email: req.body.email,\r\n        password: req.body.password,\r\n        orderList: [],\r\n        cartData: cart,\r\n    })\r\n    await user.save()\r\n    const data = {\r\n      user: {\r\n        id: user.id,\r\n        username: user.name,\r\n        email: user.email\r\n      }\r\n    }\r\n    const token = jwt.sign(data, 'secret_ecom')\r\n    res.json({ success: true, \r\n      token, \r\n      username: user.name, \r\n      email: user.email\r\n     }); // Sửa ở đây\r\n  }\r\n)\r\n\r\n//creating endpoint for user login \r\napp.post('/login', async (req, res) => {\r\n  let user = await Users.findOne({\r\n    email: req.body.email\r\n  });\r\n  \r\n  if (user) {\r\n    const passCompare = req.body.password === user.password;\r\n    if (passCompare) {\r\n      const data = {\r\n        user: {\r\n          id: user.id,\r\n          username: user.name,\r\n          email: user.email\r\n        }\r\n      };\r\n      const token = jwt.sign(data, 'secret_ecom');\r\n      res.json({ success: true, \r\n                    token, \r\n                    username: user.name, \r\n                    email: user.email }); // Sửa ở đây\r\n    } else {\r\n      res.json({ success: false, errors: 'Wrong Password' });\r\n    }\r\n  } else {\r\n    res.json({ success: false, errors: 'Wrong Email Id' });\r\n  }\r\n});\r\n\r\n// creating endpoint for newcollection data\r\napp.get('/popular', async (req, res) => {\r\n  try{\r\n    const limit = 4\r\n    const category = 'women'\r\n\r\n    const popularProducts = await Product.find({category}).limit(limit)\r\n\r\n    res.json({\r\n      success: true,\r\n      data: popularProducts\r\n    })\r\n  }catch (error) {\r\n    res.status(500).json({ success: false, message: \"Internal server error\" });\r\n  }\r\n})\r\n// creating endpoint for newcollection data\r\n// app.get('/newcollection', async (req, res) => {\r\n//   let products = await Product.find({})\r\n//   let newcollection = products.slices\r\n// })\r\n\r\n// creating middleware to fetch user\r\n\r\nconst fetchUser = async (req,res, next) => {\r\n    const token = req.header('auth-token')\r\n    // console.log(token)\r\n    if (!token) {\r\n        res.status(401).send({\r\n          errors: 'Please authenticate using valid token'\r\n        })\r\n    }\r\n      else\r\n      {\r\n          try{\r\n            const data = jwt.verify(token, 'secret_ecom')\r\n            req.user = data.user\r\n            next()\r\n          }catch(error){\r\n            res.status(401).send({errors: \"Please authenticate using valid token\"})\r\n            console.log(error)\r\n          }\r\n        }\r\n}\r\n\r\n// creating endpoint for adding product in cartData\r\n// app.post('/addtocart', fetchUser , async (req, res) => {\r\n//   // console.log('Added', req.body.itemId)\r\n//   let userData = await Users.findOne({_id: req.user.id})\r\n//   if(userData && userData.cartData){\r\n//     userData.cartData[req.body.itemId] += 1\r\n//     await Users.findOneAndUpdate({_id: req.user.id},{cartData: userData.cartData})\r\n//     res.send(\"Added\")\r\n//   }else{\r\n//     console.log('chưa có userData')\r\n//   }\r\n// })\r\napp.post('/addtocart', fetchUser , async (req, res) => {\r\n  // console.log(req.body.cartItem)\r\n  try {\r\n    const userId = req.user.id;\r\n    const itemId = req.body.cartItem.id; // Lấy id của sản phẩm từ request body\r\n    let userData = await Users.findOne({_id: userId});\r\n    // Kiểm tra xem người dùng đã có giỏ hàng hay chưa\r\n    if (!userData.cartDetails) {\r\n      userData.cartDetails = []; // Nếu chưa, khởi tạo giỏ hàng cho người dùng\r\n    }\r\n    // Tìm xem sản phẩm đã tồn tại trong giỏ hàng của người dùng chưa\r\n    const existingItemIndex = userData.cartDetails.findIndex(item => item.id === itemId);\r\n    if (existingItemIndex !== -1) {\r\n      // Nếu sản phẩm đã tồn tại trong giỏ hàng, tăng số lượng lên 1\r\n      userData.cartDetails[existingItemIndex].quantity += 1;\r\n    } else {\r\n      // Nếu sản phẩm chưa tồn tại trong giỏ hàng, thêm sản phẩm vào giỏ hàng với số lượng là 1\r\n      userData.cartDetails.push({\r\n        ...req.body.cartItem,\r\n        quantity: 1\r\n      });\r\n    }\r\n    // Lưu cập nhật giỏ hàng vào cơ sở dữ liệu\r\n    await userData.save();\r\n\r\n    res.status(200).send(\"Item added to cart successfully\");\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).send(\"Internal server error\");\r\n  }\r\n});\r\n\r\n// app.post('/descrementfromcart', fetchUser , async (req, res) => {\r\n//   console.log('Removed', req.body.itemId)\r\n//   let userData = await Users.findOne({_id: req.user.id})\r\n//   if(userData.cartData[req.body.itemId] > 0) {\r\n//     userData.cartData[req.body.itemId] -= 1\r\n//     await Users.findOneAndUpdate({_id: req.user.id},{cartData: userData.cartData})\r\n//     res.send(\"Removed\")\r\n//   }\r\n// })\r\n\r\n// Endpoint để giảm số lượng của một sản phẩm trong giỏ hàng\r\napp.post('/descrementfromcart', fetchUser, async (req, res) => {\r\n  try {\r\n    const userId = req.user.id;\r\n    const itemId = req.body.itemId; // Lấy id của sản phẩm từ request body\r\n    let userData = await Users.findOne({ _id: userId });\r\n\r\n    if (!userData) {\r\n      return res.status(404).send(\"User not found\");\r\n    }\r\n\r\n    // Tìm chỉ mục của sản phẩm trong giỏ hàng của người dùng\r\n    const itemIndex = userData.cartDetails.findIndex(item => item.id === itemId);\r\n    if (itemIndex !== -1 && userData.cartDetails[itemIndex] && userData.cartDetails[itemIndex].quantity > 0) {\r\n      console.log(\"quantity before decrement:\", userData.cartDetails[itemIndex].quantity);\r\n      \r\n      // Nếu sản phẩm tồn tại trong giỏ hàng và có số lượng lớn hơn 0, giảm số lượng đi 1\r\n      userData.cartDetails[itemIndex].quantity -= 1;\r\n      \r\n      // Lưu cập nhật giỏ hàng vào cơ sở dữ liệu\r\n      await userData.save();\r\n      console.log(\"quantity after decrement:\", userData.cartDetails[itemIndex].quantity);\r\n      console.log('userData', userData)\r\n      \r\n      return res.status(200).send(\"Item quantity decremented successfully\");\r\n    } else {\r\n      return res.status(400).send(\"No items to decrement\");\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    return res.status(500).send(\"Internal server error\");\r\n  }\r\n});\r\n\r\n\r\n\r\n\r\n// Endpoint để tăng số lượng của một sản phẩm trong giỏ hàng\r\napp.post('/incrementformcart', fetchUser, async (req, res) => {\r\n  try {\r\n    const userId = req.user.id;\r\n    const itemId = req.body.itemId; // Lấy id của sản phẩm từ request body\r\n    const userData = await Users.findOneAndUpdate(\r\n      { _id: userId, \"cartDetails.id\": itemId }, // Tìm người dùng với ID và itemId phù hợp\r\n      { $inc: { \"cartDetails.$.quantity\": 1 } }, // Tăng quantity của mục có itemId tương ứng\r\n      { new: true } // Trả về tài liệu đã cập nhật\r\n    );\r\n\r\n    if (userData) {\r\n      return res.status(200).send(\"Item quantity incremented successfully\");\r\n    } else {\r\n      return res.status(400).send(\"Item not found in cart\");\r\n    }\r\n  } catch (error) {\r\n    console.error(error);\r\n    return res.status(500).send(\"Internal server error\");\r\n  }\r\n});\r\n\r\n// Endpoint để xóa một sản phẩm khỏi giỏ hàng\r\napp.post('/removefromcart', fetchUser , async (req, res) => {\r\n  try {\r\n    const userId = req.user.id;\r\n    const itemId = req.body.itemId; // Lấy id của sản phẩm từ request body\r\n    let userData = await Users.findOne({_id: userId});\r\n\r\n    // Kiểm tra xem người dùng có giỏ hàng hay không và giỏ hàng có sản phẩm đó không\r\n    if (userData && userData.cartDetails) {\r\n      const existingItemIndex = userData.cartDetails.findIndex(item => item.id === itemId);\r\n      if (existingItemIndex !== -1) {\r\n        userData.cartDetails.splice(existingItemIndex, 1); // Xóa sản phẩm khỏi giỏ hàng\r\n        await userData.save();\r\n        return res.status(200).send(\"Item removed from cart successfully\");\r\n      }\r\n    }\r\n    // Nếu không tìm thấy sản phẩm, trả về thông báo lỗi\r\n    res.status(400).send(\"Item not found in cart\");\r\n  } catch (error) {\r\n    console.error(error);\r\n    res.status(500).send(\"Internal server error\");\r\n  }\r\n});\r\n\r\n\r\n// app.post('/removefromcart', fetchUser , async (req, res) => {\r\n//   try {\r\n//     const userId = req.user.id;\r\n//     const itemId = req.body.itemId;\r\n\r\n//     let userData = await Users.findOne({_id: userId});\r\n\r\n//     if(userData && userData.cartData && userData.cartData[itemId] > 0) {\r\n//       // Xóa hết số lượng sản phẩm trong giỏ hàng cho itemId\r\n//       userData.cartData[itemId] = 0;\r\n\r\n//       await Users.findOneAndUpdate({_id: userId}, {cartData: userData.cartData});\r\n//       res.status(200).send(\"All items removed\");\r\n//     } else {\r\n//       res.status(400).send(\"No items to remove\");\r\n//     }\r\n//   } catch (error) {\r\n//     console.error(error);\r\n//     res.status(500).send(\"Internal server error\");\r\n//   }\r\n// });\r\n\r\n// creating endpoint to get cartdata\r\n// creating endpoint to get cartdata\r\n\r\n// app.post('/getcart', fetchUser, async (req, res) => {\r\n//   try {\r\n//       // Truy xuất dữ liệu người dùng từ middleware fetchUser\r\n//       const userId = req.user.id;\r\n//       // Tìm người dùng trong cơ sở dữ liệu\r\n//       const userData = await Users.findOne({ _id: userId });\r\n\r\n//       console.log('userData', userData)\r\n//       // Kiểm tra xem dữ liệu người dùng và giỏ hàng có tồn tại không\r\n//       if (userData && userData.cartData) {\r\n//           // Nếu tồn tại, trả về dữ liệu giỏ hàng dưới dạng JSON\r\n//           res.json(userData.cartData);\r\n//       } else {\r\n//           // Nếu không tìm thấy dữ liệu người dùng hoặc giỏ hàng, trả về thông báo lỗi\r\n//           res.status(404).json({ success: false, message: 'User or cart data not found' });\r\n//       }\r\n//   } catch (error) {\r\n//       // Xử lý lỗi nếu có bất kỳ lỗi nào xảy ra trong quá trình xử lý yêu cầu\r\n//       console.error(error);\r\n//       res.status(500).json({ success: false, message: 'Internal server error' });\r\n//   }\r\n// });\r\n\r\n\r\n// creating endpoint for checkout cart\r\napp.post('/orderList', async (req, res) => {\r\n  try{\r\n    const order = req.body\r\n    const user = await Users.findOne({\r\n        email:  order.customerInfo.email\r\n    })\r\n    if(!user){\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: 'User not found'\r\n      })\r\n    }\r\n    const newOrder = { \r\n      orderId : order.orderId,\r\n      orderInfo : {\r\n        ...order.orderInfo,\r\n        orderDate: order.orderInfo.orderDate\r\n      },\r\n      orderDetails: order.orderDetails,\r\n      customerInfo : order.customerInfo\r\n    }\r\n\r\n    user.orderList.push(newOrder)\r\n\r\n    await user.save()\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Order successfully processed and saved'\r\n    })\r\n  }catch(error){\r\n    console.log(error)\r\n    res.status(500).json({\r\n      success: false,\r\n      message: 'Internal server error'\r\n    })\r\n  }\r\n})\r\n// endpoint get all orderList\r\n\r\napp.get('/orderList', async (req, res) => {\r\n  try {\r\n   \r\n    const users = await Users.find({}, 'orderList');\r\n    const allOrderList = users.map(user => user.orderList);\r\n\r\n    const orderList = allOrderList.flat()\r\n\r\n    res.status(200).json(orderList);\r\n  } catch (error) {\r\n    console.error('Error while fetching all cartDetails:', error);\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\nconst port = process.env.PORT || 4000; // Sử dụng cổng do Render cung cấp hoặc 4000 nếu không có cổng nào được cung cấp\r\n\r\napp.listen(port, (error) => {\r\n  if (!error) {\r\n    console.log(\"Server Running on port: \" + port);\r\n  } else {\r\n    console.log(\"Error:\" + error);\r\n  }\r\n});"],"mappings":"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"}},"mtime":1709699338385}}